{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/lib/db.js"],"sourcesContent":["const { Pool } = require('pg');\n\nlet pool;\n\nfunction getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false\n    });\n  }\n  return pool;\n}\n\nasync function query(text, params) {\n  const pool = getPool();\n  const result = await pool.query(text, params);\n  return result;\n}\n\nmodule.exports = { getPool, query };"],"names":[],"mappings":"AAAA,MAAM,EAAE,IAAI,EAAE;AAEd,IAAI;AAEJ,SAAS;IACP,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,KAAK;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK,sCAAwC,0BAAgC;QAC/E;IACF;IACA,OAAO;AACT;AAEA,eAAe,MAAM,IAAI,EAAE,MAAM;IAC/B,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,MAAM;IACtC,OAAO;AACT;AAEA,OAAO,OAAO,GAAG;IAAE;IAAS;AAAM"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/lib/auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst bcrypt = require('bcrypt');\nconst { query } = require('./db');\n\nasync function hashPassword(password) {\n  return await bcrypt.hash(password, 10);\n}\n\nasync function verifyPassword(password, hashedPassword) {\n  return await bcrypt.compare(password, hashedPassword);\n}\n\nfunction generateToken(userId) {\n  return jwt.sign({ userId }, process.env.JWT_SECRET, { expiresIn: '24h' });\n}\n\nfunction verifyToken(token) {\n  try {\n    return jwt.verify(token, process.env.JWT_SECRET);\n  } catch (error) {\n    return null;\n  }\n}\n\nasync function authenticateRequest(req) {\n  const authHeader = req.headers.authorization;\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return { error: 'Access token required', status: 401 };\n  }\n\n  const decoded = verifyToken(token);\n  if (!decoded) {\n    return { error: 'Invalid token', status: 403 };\n  }\n\n  // Verify user still exists and is approved\n  const userResult = await query(\n    'SELECT id, username, email, full_name, role, approved FROM users WHERE id = $1 AND approved = true',\n    [decoded.userId]\n  );\n\n  if (userResult.rows.length === 0) {\n    return { error: 'User not found or not approved', status: 403 };\n  }\n\n  return { user: userResult.rows[0] };\n}\n\nfunction requireRole(roles) {\n  return (user) => {\n    if (!roles.includes(user.role)) {\n      return { error: 'Insufficient permissions', status: 403 };\n    }\n    return null;\n  };\n}\n\nmodule.exports = {\n  hashPassword,\n  verifyPassword,\n  generateToken,\n  verifyToken,\n  authenticateRequest,\n  requireRole\n};"],"names":[],"mappings":"AAAA,MAAM;AACN,MAAM;AACN,MAAM,EAAE,KAAK,EAAE;AAEf,eAAe,aAAa,QAAQ;IAClC,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU;AACrC;AAEA,eAAe,eAAe,QAAQ,EAAE,cAAc;IACpD,OAAO,MAAM,OAAO,OAAO,CAAC,UAAU;AACxC;AAEA,SAAS,cAAc,MAAM;IAC3B,OAAO,IAAI,IAAI,CAAC;QAAE;IAAO,GAAG,QAAQ,GAAG,CAAC,UAAU,EAAE;QAAE,WAAW;IAAM;AACzE;AAEA,SAAS,YAAY,KAAK;IACxB,IAAI;QACF,OAAO,IAAI,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEA,eAAe,oBAAoB,GAAG;IACpC,MAAM,aAAa,IAAI,OAAO,CAAC,aAAa;IAC5C,MAAM,QAAQ,cAAc,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;IAEpD,IAAI,CAAC,OAAO;QACV,OAAO;YAAE,OAAO;YAAyB,QAAQ;QAAI;IACvD;IAEA,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;YAAE,OAAO;YAAiB,QAAQ;QAAI;IAC/C;IAEA,2CAA2C;IAC3C,MAAM,aAAa,MAAM,MACvB,sGACA;QAAC,QAAQ,MAAM;KAAC;IAGlB,IAAI,WAAW,IAAI,CAAC,MAAM,KAAK,GAAG;QAChC,OAAO;YAAE,OAAO;YAAkC,QAAQ;QAAI;IAChE;IAEA,OAAO;QAAE,MAAM,WAAW,IAAI,CAAC,EAAE;IAAC;AACpC;AAEA,SAAS,YAAY,KAAK;IACxB,OAAO,CAAC;QACN,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG;YAC9B,OAAO;gBAAE,OAAO;gBAA4B,QAAQ;YAAI;QAC1D;QACA,OAAO;IACT;AACF;AAEA,OAAO,OAAO,GAAG;IACf;IACA;IACA;IACA;IACA;IACA;AACF"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/pages/api/auth/me.js"],"sourcesContent":["const { authenticateRequest } = require('../../../lib/auth');\n\nexport default async function handler(req, res) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const authResult = await authenticateRequest(req);\n    if (authResult.error) {\n      return res.status(authResult.status).json({ error: authResult.error });\n    }\n\n    res.json({ user: authResult.user });\n  } catch (error) {\n    console.error('Auth me error:', error);\n    res.status(500).json({ error: 'Authentication failed' });\n  }\n}"],"names":[],"mappings":";;;;AAAA,MAAM,EAAE,mBAAmB,EAAE;AAEd,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM,aAAa,MAAM,oBAAoB;QAC7C,IAAI,WAAW,KAAK,EAAE;YACpB,OAAO,IAAI,MAAM,CAAC,WAAW,MAAM,EAAE,IAAI,CAAC;gBAAE,OAAO,WAAW,KAAK;YAAC;QACtE;QAEA,IAAI,IAAI,CAAC;YAAE,MAAM,WAAW,IAAI;QAAC;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAwB;IACxD;AACF"}}]
}