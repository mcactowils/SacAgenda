{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/lib/db.js"],"sourcesContent":["const { Pool } = require('pg');\n\nlet pool;\n\nfunction getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false\n    });\n  }\n  return pool;\n}\n\nasync function query(text, params) {\n  const pool = getPool();\n  const result = await pool.query(text, params);\n  return result;\n}\n\nmodule.exports = { getPool, query };"],"names":[],"mappings":"AAAA,MAAM,EAAE,IAAI,EAAE;AAEd,IAAI;AAEJ,SAAS;IACP,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,KAAK;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK,sCAAwC,0BAAgC;QAC/E;IACF;IACA,OAAO;AACT;AAEA,eAAe,MAAM,IAAI,EAAE,MAAM;IAC/B,MAAM,OAAO;IACb,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,MAAM;IACtC,OAAO;AACT;AAEA,OAAO,OAAO,GAAG;IAAE;IAAS;AAAM"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/lib/auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst bcrypt = require('bcrypt');\nconst { query } = require('./db');\n\nasync function hashPassword(password) {\n  return await bcrypt.hash(password, 10);\n}\n\nasync function verifyPassword(password, hashedPassword) {\n  return await bcrypt.compare(password, hashedPassword);\n}\n\nfunction generateToken(userId) {\n  return jwt.sign({ userId }, process.env.JWT_SECRET, { expiresIn: '24h' });\n}\n\nfunction verifyToken(token) {\n  try {\n    return jwt.verify(token, process.env.JWT_SECRET);\n  } catch (error) {\n    return null;\n  }\n}\n\nasync function authenticateRequest(req) {\n  const authHeader = req.headers.authorization;\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return { error: 'Access token required', status: 401 };\n  }\n\n  const decoded = verifyToken(token);\n  if (!decoded) {\n    return { error: 'Invalid token', status: 403 };\n  }\n\n  // Verify user still exists and is approved\n  const userResult = await query(\n    'SELECT id, username, email, full_name, role, approved FROM users WHERE id = $1 AND approved = true',\n    [decoded.userId]\n  );\n\n  if (userResult.rows.length === 0) {\n    return { error: 'User not found or not approved', status: 403 };\n  }\n\n  return { user: userResult.rows[0] };\n}\n\nfunction requireRole(roles) {\n  return (user) => {\n    if (!roles.includes(user.role)) {\n      return { error: 'Insufficient permissions', status: 403 };\n    }\n    return null;\n  };\n}\n\nmodule.exports = {\n  hashPassword,\n  verifyPassword,\n  generateToken,\n  verifyToken,\n  authenticateRequest,\n  requireRole\n};"],"names":[],"mappings":"AAAA,MAAM;AACN,MAAM;AACN,MAAM,EAAE,KAAK,EAAE;AAEf,eAAe,aAAa,QAAQ;IAClC,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU;AACrC;AAEA,eAAe,eAAe,QAAQ,EAAE,cAAc;IACpD,OAAO,MAAM,OAAO,OAAO,CAAC,UAAU;AACxC;AAEA,SAAS,cAAc,MAAM;IAC3B,OAAO,IAAI,IAAI,CAAC;QAAE;IAAO,GAAG,QAAQ,GAAG,CAAC,UAAU,EAAE;QAAE,WAAW;IAAM;AACzE;AAEA,SAAS,YAAY,KAAK;IACxB,IAAI;QACF,OAAO,IAAI,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEA,eAAe,oBAAoB,GAAG;IACpC,MAAM,aAAa,IAAI,OAAO,CAAC,aAAa;IAC5C,MAAM,QAAQ,cAAc,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;IAEpD,IAAI,CAAC,OAAO;QACV,OAAO;YAAE,OAAO;YAAyB,QAAQ;QAAI;IACvD;IAEA,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS;QACZ,OAAO;YAAE,OAAO;YAAiB,QAAQ;QAAI;IAC/C;IAEA,2CAA2C;IAC3C,MAAM,aAAa,MAAM,MACvB,sGACA;QAAC,QAAQ,MAAM;KAAC;IAGlB,IAAI,WAAW,IAAI,CAAC,MAAM,KAAK,GAAG;QAChC,OAAO;YAAE,OAAO;YAAkC,QAAQ;QAAI;IAChE;IAEA,OAAO;QAAE,MAAM,WAAW,IAAI,CAAC,EAAE;IAAC;AACpC;AAEA,SAAS,YAAY,KAAK;IACxB,OAAO,CAAC;QACN,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG;YAC9B,OAAO;gBAAE,OAAO;gBAA4B,QAAQ;YAAI;QAC1D;QACA,OAAO;IACT;AACF;AAEA,OAAO,OAAO,GAAG;IACf;IACA;IACA;IACA;IACA;IACA;AACF"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///Users/mattwilson/Projects/SacAgenda/pages/api/auth/login.js"],"sourcesContent":["const { query } = require('../../../lib/db');\nconst { verifyPassword, generateToken } = require('../../../lib/auth');\n\nexport default async function handler(req, res) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { username, password } = req.body;\n\n    const result = await query(\n      'SELECT id, username, email, password_hash, full_name, role, approved FROM users WHERE username = $1',\n      [username]\n    );\n\n    const user = result.rows[0];\n    if (!user) {\n      return res.status(401).json({ error: 'Invalid credentials' });\n    }\n\n    if (!user.approved) {\n      return res.status(403).json({ error: 'Account pending approval' });\n    }\n\n    const validPassword = await verifyPassword(password, user.password_hash);\n    if (!validPassword) {\n      return res.status(401).json({ error: 'Invalid credentials' });\n    }\n\n    const token = generateToken(user.id);\n\n    // Clean up old sessions and save new one\n    await query('DELETE FROM user_sessions WHERE user_id = $1', [user.id]);\n    await query(\n      'INSERT INTO user_sessions (user_id, token, expires_at) VALUES ($1, $2, $3)',\n      [user.id, token, new Date(Date.now() + 24 * 60 * 60 * 1000)]\n    );\n\n    const { password_hash, ...userWithoutPassword } = user;\n    res.json({ success: true, user: userWithoutPassword, token });\n\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({ error: 'Login failed' });\n  }\n}"],"names":[],"mappings":";;;;AAAA,MAAM,EAAE,KAAK,EAAE;AACf,MAAM,EAAE,cAAc,EAAE,aAAa,EAAE;AAExB,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;QAEvC,MAAM,SAAS,MAAM,MACnB,uGACA;YAAC;SAAS;QAGZ,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAC3B,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAsB;QAC7D;QAEA,IAAI,CAAC,KAAK,QAAQ,EAAE;YAClB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA2B;QAClE;QAEA,MAAM,gBAAgB,MAAM,eAAe,UAAU,KAAK,aAAa;QACvE,IAAI,CAAC,eAAe;YAClB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAsB;QAC7D;QAEA,MAAM,QAAQ,cAAc,KAAK,EAAE;QAEnC,yCAAyC;QACzC,MAAM,MAAM,gDAAgD;YAAC,KAAK,EAAE;SAAC;QACrE,MAAM,MACJ,8EACA;YAAC,KAAK,EAAE;YAAE;YAAO,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;SAAM;QAG9D,MAAM,EAAE,aAAa,EAAE,GAAG,qBAAqB,GAAG;QAClD,IAAI,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;YAAqB;QAAM;IAE7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;IAC/C;AACF"}}]
}